@model TSN_HR_Web.Models.ViewModels.ThanhPhanGiaDinhViewModel
@{
    bool isReadOnly = ViewBag.ReadOnly == true;
}
<div class="row justify-content-center">
    <div class="col-lg-3 col-md-3"></div>
    <div class="col-lg-9 col-md-9">
        <!-- ===== ROW 1 ===== -->
        <div class="row g-3 mb-2">
            <div class="col-lg-4 col-md-6">
                <label>Họ và Tên đệm</label>
                <input asp-for="HoVaTenDem" class="form-control rounded-pill"
                    readonly="@(isReadOnly ? "readonly" : null)" />
            </div>
            <div class="col-lg-2 col-md-6">
                <label>Tên</label>
                <input asp-for="Ten" class="form-control rounded-pill" readonly="@(isReadOnly ? "readonly" : null)" />
            </div>
            <div class="col-lg-2 col-md-6 " d-flex align-items-center gap-3">
                <label class="d-block mb-0">Giới tính</label>
                <label class="me-2">
                    <input type="radio" asp-for="GioiTinh" value="1" disabled="@(isReadOnly ? "disabled" : null)" />
                    Nam
                </label>
                <label class="me-2">
                    <input type="radio" asp-for="GioiTinh" value="2" disabled="@(isReadOnly ? "disabled" : null)" /> Nữ
                </label>
            </div>
        </div>
        <!-- ROW 2 -->
        <div class="row align-items-center g-3 py-2">
            <div class="col-lg-3 col-md-6">
                <label>Ngày sinh</label>
                <input asp-for="NgaySinh" type="date" class="form-control rounded-pill"
                    readonly="@(isReadOnly ? "readonly" : null)" />
            </div>
            <div class="col-lg-2 col-md-6">
                <label>Quan hệ</label>
                <input asp-for="QuanHe" class="form-control rounded-pill"
                    readonly="@(isReadOnly ? "readonly" : null)" />
            </div>

            <div class="col-lg-3 col-md-6">
                <label>Nghề nghiệp</label>
                <input asp-for="NgheNghiep" class="form-control rounded-pill"
                    readonly="@(isReadOnly ? "readonly" : null)" />
            </div>
        </div>
        <!-- ROW 3 -->
        <div class="row align-items-center g-3 py-2">
            <div class="col-lg-8 col-md-6">
                <label>Địa chỉ công tác</label>
                <input asp-for="DiaChiCongTac" class="form-control rounded-pill"
                    readonly="@(isReadOnly ? "readonly" : null)" />
            </div>
        </div>
    </div>
    <!-- ===== BUTTON THÊM ===== -->
    <div class="d-flex justify-content-end mb-3">
        <button type="button" class="btn btn-primary rounded-pill px-4" onclick="addThanhPhanGiaDinh()">
            + Thêm
        </button>
    </div>

    <hr />
    <!-- ===== TABLE DANH SÁCH ===== -->
    <div class="card shadow-sm border-0 rounded-4 mt-3">
        <div class="table-responsive p-3">
            <table id="tpGiaDinhTable" class="display w-100"></table>
        </div>
    </div>
</div>
<script>
    window.thanhPhanGiaDinhTemp = [];
    $(function () {
        window.tpGiaDinhTable = $('#tpGiaDinhTable').DataTable({
            data: @Html.Raw(Json.Serialize(Model.Items)),

            paging: false,
            searching: false,
            info: false,
            ordering: false,

            columns: [
                {
                    data: 'hoVaTenDem',
                    title: 'Họ và Tên Đệm',
                    className: 'text-center'
                },
                {
                    data: 'ten',
                    title: 'Tên',
                    className: 'text-center'
                },
                {
                    data: 'ngaySinh',
                    title: 'Ngày sinh',
                    className: 'text-center'
                },
                {
                    data: 'quanHe',
                    title: 'Quan hệ',
                    className: 'text-center'
                },
                {
                    data: 'ngheNghiep',
                    title: 'Nghề nghiệp',
                    className: 'text-center'
                },
                {
                    data: 'diaChiCongTac',
                    title: 'Địa chỉ công tác',
                    className: 'text-center'
                },
                {
                    data: 'id',
                    title: 'Thao tác',
                    orderable: false,
                    searchable: false,
                    className: 'text-center',
                    render: function (data, type, row) {
                        return `
                                        <button class="btn btn-sm btn-warning text-white">
                                            Chi tiết
                                        </button>
                                    `;
                    }
                }
            ],

            language: {
                url: 'https://cdn.datatables.net/plug-ins/1.13.8/i18n/vi.json',
                emptyTable: "Chưa có thông tin..."
            }
        });
    });
    window.thanhPhanGiaDinhTemp = [];

    window.addThanhPhanGiaDinh = function () {
        const item = {
            hoVaTenDem: $('[name="HoVaTenDem"]').val(),
            ten: $('[name="Ten"]').val(),
            ngaySinh: $('[name="NgaySinh"]').val(),
            quanHe: $('[name="QuanHe"]').val(),
            ngheNghiep: $('[name="NgheNghiep"]').val(),
            diaChiCongTac: $('[name="DiaChiCongTac"]').val(),
            gioiTinh: $('[name="GioiTinh"]:checked').val() ?? null
        };

        if (!item.hoVaTenDem || !item.ten || !item.quanHe) {
            alert("Vui lòng nhập đầy đủ Họ tên, Tên và Quan hệ");
            return;
        }

        window.thanhPhanGiaDinhTemp.push(item);

        //cập nhật DataTable
        window.tpGiaDinhTable.clear();
        window.tpGiaDinhTable.rows.add(window.thanhPhanGiaDinhTemp);
        window.tpGiaDinhTable.draw();

        //đổ JSON xuống hidden input
        document.getElementById("ThanhPhanGiaDinhJson").value =
            JSON.stringify(window.thanhPhanGiaDinhTemp);

        // clear form
        $('[name="HoVaTenDem"],[name="Ten"],[name="NgaySinh"],[name="QuanHe"],[name="NgheNghiep"],[name="DiaChiCongTac"]').val("");
    };


</script>