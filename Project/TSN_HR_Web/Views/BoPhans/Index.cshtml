@model IEnumerable<TSN_HR_Web.Models.BoPhan>

@{
    ViewData["Title"] = "Danh Sach phong ban";
}

@section Styles {
    <link rel="stylesheet" href="~/css/BoPhan.css" />
}
<h2 class="tsn-table-title mb-3">Danh sách Phòng ban Tân Sơn Nhất Hotel</h2>
<button class="btn btn-primary" onclick="loadCreateForm()">+ Thêm mới Phòng ban</button>

<div class="card-body pt-2">
    <div class="table-wrapper table-responsive pt-2">
        <table id="bophanTable" class="table table-hover align-middle mb-0">
            <thead>
                <tr>
                    <th>Mã Phòng Ban</th>
                    <th>Tên Phòng Ban</th>
                    <th>Mã Cơ Sở</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                @{
                    foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.MaBoPhan</td>
                            <td>@item.TenBoPhan</td>
                            <td>@item.CoSoId</td>
                            <td class="text-center text-nowrap">
                                <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-link text-info"
                                    title="Chi tiết">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-link text-warning"
                                    title="Sửa">
                                    <i class="bi bi-pencil-square"></i>
                                </a>
                                <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-link text-danger"
                                    title="Xóa">
                                    <i class="bi bi-trash"></i>
                                </a>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

@* Modal for Create *@
<div class="modal fade" id="createBoPhanModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Thêm mới Phòng Ban</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body" id="createModalBody"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-primary">Lưu</button>
            </div>
        </div>
    </div>

@section Scripts {
        <script>
            // init DataTable (reuse được cho SPA)
            window.initBoPhanTable = function () {
                const table = $('#bophanTable');
                if (!table.length) return;

                if ($.fn.dataTable.isDataTable('#bophanTable')) {
                    table.DataTable().destroy();
                }

                table.DataTable({
                    paging: true,
                    searching: true,
                    ordering: true,
                    pageLength: 5,
                    lengthMenu: [5, 10, 25, 50],
                    language: {
                        url: "https://cdn.datatables.net/plug-ins/1.13.8/i18n/vi.json"
                    },
                    dom:
                        '<"row align-items-center mb-3"' +
                        '<"col-sm-6"l>' +
                        '<"col-sm-6 text-sm-end"f>' +
                        '>' +
                        'rt' +
                        '<"row align-items-center mt-3"' +
                        '<"col-sm-5"i>' +
                        '<"col-sm-7 text-sm-end"p>' +
                        '>',
                    columnDefs: [
                        { orderable: false, targets: 4 } // cột Actions không sort
                    ]
                });
            };

            // khi load trang trực tiếp
            $(document).ready(function () {
                window.initBoPhanTable();
            });

            function loadCreateForm() {
                $.get("/BoPhans/Create", function (html) {
                    $("#createModalBody").html(html);
                    var modal = new bootstrap.Modal(document.getElementById('createBoPhanModal'));
                    modal.show();
                });
            }
        </script>
}